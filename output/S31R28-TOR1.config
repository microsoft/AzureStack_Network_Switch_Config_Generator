
! header.go.tmpl-inject_header
! Name: S31R28-TOR1
! Make: Cisco
! Model: 93180YC-FX

banner motd #
NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE

Unauthorized access and/or use prohibited.
All access and/or use subject to monitoring.

NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE   NOTICE
#

hostname S31R28-TOR1

! stig.go.tmpl-stig_user
fips mode enable
user max-logins 1
password prompt username
userpassphrase min-length 15 max-length 80
username admin password 0 c2!cuh%xMC8*aRt9 role network-admin
username aszadmin-vlzxb password 0 c2!cuh%xMC8*aRt9 role network-admin
!
! SSH Key based authentication. Post process this section before applying the initial configuration.
!
! Remove the ability to login with a password
! username <sshAuthUsername> password 5 ! role network-admin
! 
! Add the public key to the config
! username <sshAuthUsername> sshkey <PublicKey>
!

! stig.go.tmpl-stig_ssh
no feature ssh
no ssh key ecdsa
no ssh key rsa
ssh key rsa 2048 force
ssh key ecdsa 256 force
feature ssh

! stig.go.tmpl-tor_feature
no feature telnet
feature scp-server
feature bgp
feature interface-vlan
feature lldp
feature dhcp
feature vpc
feature hsrp
feature lacp
feature ssh
no cdp enable
! FIPS mode will automatically enable nxapi, the work around is to remove the ports it listens on.
feature nxapi
no nxapi http
no nxapi https 

! settings.go.tmpl-ntp
clock timezone UTC 0 0
ntp server 10.10.240.20
ntp server 10.10.240.20

! settings.go.tmpl-inject_syslog
logging server 100.100.10.10 7 facility local7 use-vrf default
logging server 100.100.10.11 7 facility local7 use-vrf default
logging level local7 7
no logging console
login on-success log
logging origin-id hostname
!
logging level acllog 7
logging level aclmgr 7
logging level eth_port_channel 7
logging level hsrp 7
logging level icam 7
logging level interface-vlan 7
logging level ipqosmgr 7
logging level vlan_mgr 7
logging level vpc 7
logging level netstack 7
logging level bgp 7

! default.go.tmpl-default_snmp
snmp-server globalEnforcePriv
no snmp-server protocol enable

! qos.go.tmpl-bgp
!
! Identify the traffic
!
class-map type qos match-all RDMA
  match cos 3
class-map type qos match-all CLUSTER
  match cos 5
!
! Map the traffic to a queue map from the class-map
!
policy-map type qos AZS_SERVICES
  class RDMA
    set qos-group 3
  class CLUSTER
    set qos-group 5
!
! Ingress traffic to the Interface
!
policy-map type network-qos QOS_NETWORK
  class type network-qos c-8q-nq3
    pause pfc-cos 3
    mtu 9216
  class type network-qos c-8q-nq5
    mtu 9216
  class type network-qos c-8q-nq-default
    mtu 9216
!
! Egress traffic from the interface
!
policy-map type queuing QOS_EGRESS_PORT
  class type queuing c-out-8q-q3
    bandwidth remaining percent 50
    random-detect minimum-threshold 300 kbytes maximum-threshold 300 kbytes drop-probability 100 weight 0 ecn
  class type queuing c-out-8q-q-default
    bandwidth remaining percent 48
  class type queuing c-out-8q-q1
    bandwidth remaining percent 0
  class type queuing c-out-8q-q2
    bandwidth remaining percent 0
  class type queuing c-out-8q-q4
    bandwidth remaining percent 0
  class type queuing c-out-8q-q5
    bandwidth percent 2
  class type queuing c-out-8q-q6
    bandwidth remaining percent 0
  class type queuing c-out-8q-q7
    bandwidth remaining percent 0
!
! Apply to the system
!
system qos
  service-policy type queuing output QOS_EGRESS_PORT
  service-policy type network-qos QOS_NETWORK

! stp.go.tmpl-inject_stp
spanning-tree mode mst
spanning-tree port type edge bpduguard default
spanning-tree mst 0-1 priority 8192
spanning-tree mst 2 priority 16384
spanning-tree mst configuration
  name AzureStack
  revision 1
  instance 1 vlan 1-1999
  instance 2 vlan 2000-4094

! vlan.go.tmpl-define_vlan
vlan 2
  name Unused
vlan 7
  name Tenant0
vlan 8
  name InfraMgmt
vlan 15
  name Tenant1
vlan 125
  name BMCMgmt
vlan 711
  name Storage1
vlan 712
  name Storage2


! vlan.go.tmpl-interface_vlan
interface vlan2
  description Unused
  mtu 9000
  shutdown 
  
interface vlan7
  description Tenant0
  mtu 9000
  no shutdown
  ip address 100.100.100.3/24
  no ip redirects
  no ipv6 redirects
  hsrp version 2
    hsrp 7
    priority 0 forwarding-threshold lower 1 upper 150
    ip 100.100.100.1/24
  
interface vlan8
  description InfraMgmt
  mtu 9000
  no shutdown
  ip address 100.100.10.3/24
  no ip redirects
  no ipv6 redirects
  hsrp version 2
    hsrp 8
    priority 0 forwarding-threshold lower 1 upper 150
    ip 100.100.10.1/24
  
interface vlan15
  description Tenant1
  mtu 9000
  no shutdown
  ip address 100.100.100.3/24
  no ip redirects
  no ipv6 redirects
  hsrp version 2
    hsrp 15
    priority 0 forwarding-threshold lower 1 upper 150
    ip 100.100.100.1/24
  
interface vlan125
  description BMCMgmt
  mtu 9000
  no shutdown
  ip address 100.71.28.68/26
  no ip redirects
  no ipv6 redirects
  hsrp version 2
    hsrp 125
    priority 0 forwarding-threshold lower 1 upper 150
    ip 100.71.28.65/26
  
interface vlan711
  description Storage1
  mtu 9000
  no shutdown
  
interface vlan712
  description Storage2
  mtu 9000
  no shutdown
  

! vpc.go.tmpl-vpc_domain
vpc domain 1
  role priority 1
  peer-keepalive destination 100.73.28.162 source 100.73.28.161 vrf default
  delay restore 150
  peer-gateway
  auto-recovery

! portchannel.go.tmpl-port_channel
interface port-channel50
  description MLAG Heartbeat and iBGP TOR1-TOR2
  logging event port link-status
  mtu 9216
  no shutdown
  ip address 
  service-policy type qos input AZS_SERVICES
  priority-flow-control mode on

interface port-channel101
  description MLAG_PEER
  logging event port link-status
  mtu 9216
  no shutdown
  switchport
  switchport mode trunk
  switchport trunk native vlan 99
  spanning-tree port type network
  priority-flow-control mode on

interface port-channel102
  description VPC:TORtoBMC
  logging event port link-status
  mtu 9216
  no shutdown
  switchport
  switchport mode trunk
  switchport trunk allowed vlan 125
  spanning-tree port type network
  


! port.go.tmpl-port
interface mgmt0
  description BMCMgmt
  no ip redirects
  no ipv6 redirects
  ip address 100.71.28.66/26
  shutdown 

interface Ethernet 1/1
  description Host Port
  no cdp enable
  mtu 9216
  switchport
  switchport mode trunk
  switchport trunk native vlan 8
  switchport trunk allowed vlan 7,15
  no logging event port link-status
  spanning-tree port type edge trunk
  priority-flow-control mode on
  no shutdown 

interface Ethernet 1/2
  description Host Port
  no cdp enable
  mtu 9216
  switchport
  switchport mode trunk
  switchport trunk native vlan 8
  switchport trunk allowed vlan 7,15
  no logging event port link-status
  spanning-tree port type edge trunk
  priority-flow-control mode on
  no shutdown 

interface TenGigEthernet 1/3
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/4
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/5
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/6
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/7
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/8
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/9
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/10
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/11
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/12
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/13
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/14
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/15
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/16
  description Storage Port
  no cdp enable
  mtu 9000
  switchport
  switchport mode trunk
  switchport trunk native vlan 8
  no logging event port link-status
  spanning-tree port type edge trunk
  priority-flow-control mode on
  no shutdown 

interface TenGigEthernet 1/17
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/18
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/19
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/20
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/21
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/22
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/23
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/24
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/25
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/26
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/27
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/28
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/29
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/30
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/31
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/32
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/33
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/34
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/35
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/36
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/37
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/38
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/39
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/40
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

 
interface TenGigEthernet 1/41
  description MLAG Heartbeat and iBGP TOR1-TOR2
  no cdp enable
  mtu 9000
  logging event port link-status
  channel-group 50 mode active
  no shutdown 
 
interface TenGigEthernet 1/42
  description MLAG Heartbeat and iBGP TOR1-TOR2
  no cdp enable
  mtu 9000
  logging event port link-status
  channel-group 50 mode active
  no shutdown 
interface TenGigEthernet 1/43
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

 
interface TenGigEthernet 1/44
  description VPC:TORtoBMC
  no cdp enable
  mtu 9000
  switchport
  switchport mode trunk
  switchport trunk allowed vlan 125
  logging event port link-status
  channel-group 102 mode active
  no shutdown 
interface TenGigEthernet 1/45
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/46
  description BMCMgmt
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 125
  spanning-tree port type edge
  no logging event port link-status
  no shutdown 

interface TenGigEthernet 1/47
  description P2P_TOR1_To_Border2/TOR1
  no cdp enable
  mtu 9000
  no switchport
  ip address 100.100.1.2/31
  no shutdown 

interface TenGigEthernet 1/48
  description P2P_TOR1_To_Border1/TOR1
  no cdp enable
  mtu 9000
  no switchport
  ip address 100.100.1.0/31
  no shutdown 

 
interface TenGigEthernet 1/49
  description MLAG_PEER
  no cdp enable
  mtu 9000
  switchport
  switchport mode trunk
  switchport trunk allowed vlan 99
  logging event port link-status
  channel-group 101 mode active
  no shutdown 
 
interface TenGigEthernet 1/50
  description MLAG_PEER
  no cdp enable
  mtu 9000
  switchport
  switchport mode trunk
  switchport trunk allowed vlan 99
  logging event port link-status
  channel-group 101 mode active
  no shutdown 
 
interface TenGigEthernet 1/51
  description MLAG_PEER
  no cdp enable
  mtu 9000
  switchport
  switchport mode trunk
  switchport trunk allowed vlan 99
  logging event port link-status
  channel-group 101 mode active
  no shutdown 
interface TenGigEthernet 1/52
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/53
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 

interface TenGigEthernet 1/54
  description Unused
  no cdp enable
  mtu 9000
  switchport
  switchport access vlan 2
  spanning-tree port type edge
  no logging event port link-status
  shutdown 


! default.go.tmpl-default_errdisable_setting
errdisable recovery interval 600
errdisable recovery cause link-flap
errdisable recovery cause udld
errdisable recovery cause bpduguard
system default switchport shutdown
switching-mode store-forward

! default.go.tmpl-default_rmon
rmon event 1 description FATAL(1) owner PMON@FATAL
rmon event 2 description CRITICAL(2) owner PMON@CRITICAL
rmon event 3 description ERROR(3) owner PMON@ERROR
rmon event 4 description WARNING(4) owner PMON@WARNING
rmon event 5 description INFORMATION(5) owner PMON@INFO

! bgp_prefix_list
ip prefix-list ExternalPrefix deny 100.100.100.0/24
ip prefix-list ExternalPrefix deny 100.100.101.0/24
ip prefix-list ExternalPrefix permit 0.0.0.0/0



! bgp.go.tmpl-bgp
router bgp 65000
  router-id 100.100.1.8
  bestpath as-path multipath-relax
  log-neighbor-changes
  address-family ipv4 unicast
    maximum-paths 9
    network 100.100.100.0/24
    network 100.100.101.0/24
    network 100.100.10.0/24
    network 100.100.1.0/28
    network 100.71.28.64/26

  neighbor 100.100.1.1
    remote-as 63000
    description P2P_TOR1_To_Border1/Border1
    address-family ipv4 unicast
      maximum-prefix 12000 warning-only
      prefix-list ExternalPrefix in
      prefix-list ExternalPrefix out
      
  neighbor 100.100.1.3
    remote-as 63000
    description P2P_TOR1_To_Border2/Border2
    address-family ipv4 unicast
      maximum-prefix 12000 warning-only
      prefix-list ExternalPrefix in
      prefix-list ExternalPrefix out
      
  neighbor 
    remote-as 65000
    description PO50/TOR2_PO50
    address-family ipv4 unicast
      maximum-prefix 12000 warning-only
      
! default.go.tmpl-default_console_vty
line console
  exec-timeout 10
line vty
  exec-timeout 10
  access-class ssh-only in
  session-limit 3
